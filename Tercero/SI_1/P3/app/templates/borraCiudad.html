<!DOCTYPE HTML> 
<!--
 Ejemplo de transaccion
 - no considerar NOT FOUND como error
 - se puede usar transaccion SQLAlchemy o SQL
 - eliminar ON DELETE CASCADE
 - alterar orden de borrado para forzar error y comprobar que rollback funciona
-->
<HTML> 
  <HEAD> 
	  <META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=utf-8"> 
	  <TITLE>Ejemplo de Transacción con Flask SQLAlchemy</TITLE>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  </HEAD> 

  <BODY>
 
    <h2> Ejemplo de Transacción con Flask SQLAlchemy</h2>

    <form name="entrada" method="post" action="">
      <table>
        <tr><td>Ciudad:</td><td><input type="text" name="city" value="herman"></td></tr>
      </table>
      <p>
      <input type="radio" name="txnSQL" value="1" checked="checked">Transacción vía sentencias SQL</input>
      <br>
      <input type="radio" name="txnSQL" value="0">Transacción vía funciones SQLAlchemy</input>
      </p>
      <p>
      <input type="checkbox" name="bCommit">Ejecutar commit intermedio
      </p>
      <p>
      <input type="checkbox" name="bFallo" checked="checked">Provocar error de integridad
      </p>
      <p>
      Duerme <input type="text" name="duerme" value="0"></input> segundos (para forzar deadlock).
      </p>
      <p>
      <input type="submit" value="Enviar"/>
      </p>
    </form>
    
    <h3>Trazas</h3>
    
    <ol>
    {% for paso in dbr %}
        <li>{{ paso|safe }}</li>
    {% endfor %}
    </ol>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
  </BODY>
</HTML>
